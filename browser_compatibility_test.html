<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>跨浏览器兼容性测试</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #FF6B6B 0%, #4ECDC4 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0 0 10px 0;
            font-size: 2.5em;
        }
        
        .content {
            padding: 40px;
        }
        
        .browser-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            border-left: 4px solid #4ECDC4;
        }
        
        .test-section {
            margin-bottom: 40px;
            padding: 30px;
            border: 1px solid #eee;
            border-radius: 12px;
            background: #fafafa;
        }
        
        .test-title {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 2px solid #4ECDC4;
            padding-bottom: 10px;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .test-item {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #ddd;
            transition: all 0.3s ease;
        }
        
        .test-item:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .test-name {
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }
        
        .test-result {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-icon {
            font-size: 20px;
        }
        
        .status-text {
            font-size: 14px;
        }
        
        .supported { color: #4CAF50; }
        .partial { color: #ff9800; }
        .unsupported { color: #f44336; }
        
        .feature-details {
            margin-top: 10px;
            font-size: 12px;
            color: #666;
            background: #f5f5f5;
            padding: 8px;
            border-radius: 4px;
        }
        
        .run-tests-btn {
            background: linear-gradient(135deg, #4ECDC4 0%, #44A08D 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 20px 0;
            box-shadow: 0 4px 12px rgba(78, 205, 196, 0.3);
            transition: all 0.3s ease;
        }
        
        .run-tests-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(78, 205, 196, 0.4);
        }
        
        .compatibility-summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            margin-top: 40px;
        }
        
        .score {
            font-size: 3em;
            font-weight: bold;
            margin: 20px 0;
        }
        
        .recommendations {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 20px;
            margin-top: 30px;
        }
        
        .recommendations h3 {
            color: #856404;
            margin-top: 0;
        }
        
        .recommendation-item {
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 4px;
            border-left: 4px solid #ff9800;
        }
        
        @media (max-width: 768px) {
            .test-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🌐 跨浏览器兼容性测试</h1>
            <p>白噪音应用在不同浏览器中的兼容性检测</p>
        </div>
        
        <div class="content">
            <div class="browser-info">
                <h3>📊 当前浏览器信息</h3>
                <div id="browser-details"></div>
            </div>
            
            <button class="run-tests-btn" onclick="runCompatibilityTests()">
                🚀 开始兼容性测试
            </button>
            
            <div class="test-section">
                <h2 class="test-title">🔧 核心Web API支持</h2>
                <div class="test-grid" id="api-tests"></div>
            </div>
            
            <div class="test-section">
                <h2 class="test-title">🎵 音频功能支持</h2>
                <div class="test-grid" id="audio-tests"></div>
            </div>
            
            <div class="test-section">
                <h2 class="test-title">💾 存储功能支持</h2>
                <div class="test-grid" id="storage-tests"></div>
            </div>
            
            <div class="test-section">
                <h2 class="test-title">🎨 CSS功能支持</h2>
                <div class="test-grid" id="css-tests"></div>
            </div>
            
            <div class="test-section">
                <h2 class="test-title">📱 移动端功能支持</h2>
                <div class="test-grid" id="mobile-tests"></div>
            </div>
            
            <div id="compatibility-summary" class="compatibility-summary" style="display: none;">
                <h2>📈 兼容性评分</h2>
                <div class="score" id="compatibility-score">-</div>
                <p id="compatibility-description">正在计算兼容性评分...</p>
            </div>
            
            <div id="recommendations" class="recommendations" style="display: none;">
                <h3>💡 兼容性建议</h3>
                <div id="recommendation-list"></div>
            </div>
        </div>
    </div>

    <script>
        class BrowserCompatibilityTester {
            constructor() {
                this.testResults = {};
                this.totalTests = 0;
                this.passedTests = 0;
                this.browserInfo = this.getBrowserInfo();
            }

            getBrowserInfo() {
                const ua = navigator.userAgent;
                const browser = {
                    name: '未知',
                    version: '未知',
                    engine: '未知',
                    platform: navigator.platform,
                    language: navigator.language,
                    cookieEnabled: navigator.cookieEnabled,
                    onLine: navigator.onLine,
                    userAgent: ua
                };

                // 检测浏览器类型
                if (ua.includes('Chrome') && !ua.includes('Edg')) {
                    browser.name = 'Chrome';
                    browser.version = ua.match(/Chrome\/(\d+)/)?.[1] || '未知';
                    browser.engine = 'Blink';
                } else if (ua.includes('Firefox')) {
                    browser.name = 'Firefox';
                    browser.version = ua.match(/Firefox\/(\d+)/)?.[1] || '未知';
                    browser.engine = 'Gecko';
                } else if (ua.includes('Safari') && !ua.includes('Chrome')) {
                    browser.name = 'Safari';
                    browser.version = ua.match(/Version\/(\d+)/)?.[1] || '未知';
                    browser.engine = 'WebKit';
                } else if (ua.includes('Edg')) {
                    browser.name = 'Edge';
                    browser.version = ua.match(/Edg\/(\d+)/)?.[1] || '未知';
                    browser.engine = 'Blink';
                } else if (ua.includes('Opera') || ua.includes('OPR')) {
                    browser.name = 'Opera';
                    browser.version = ua.match(/(?:Opera|OPR)\/(\d+)/)?.[1] || '未知';
                    browser.engine = 'Blink';
                }

                return browser;
            }

            runAllTests() {
                this.displayBrowserInfo();
                
                // 运行各类测试
                this.testWebAPIs();
                this.testAudioFeatures();
                this.testStorageFeatures();
                this.testCSSFeatures();
                this.testMobileFeatures();
                
                // 计算并显示兼容性评分
                this.calculateCompatibilityScore();
                this.generateRecommendations();
            }

            testWebAPIs() {
                const apiTests = [
                    {
                        name: 'Fetch API',
                        test: () => typeof fetch !== 'undefined',
                        importance: 'high',
                        description: '用于网络请求'
                    },
                    {
                        name: 'Promise',
                        test: () => typeof Promise !== 'undefined',
                        importance: 'high',
                        description: '异步编程支持'
                    },
                    {
                        name: 'async/await',
                        test: () => {
                            try {
                                eval('(async function() {})');
                                return true;
                            } catch (e) {
                                return false;
                            }
                        },
                        importance: 'high',
                        description: '现代异步语法'
                    },
                    {
                        name: 'ES6 Classes',
                        test: () => {
                            try {
                                eval('class Test {}');
                                return true;
                            } catch (e) {
                                return false;
                            }
                        },
                        importance: 'high',
                        description: 'ES6类语法支持'
                    },
                    {
                        name: 'Arrow Functions',
                        test: () => {
                            try {
                                eval('(() => {})');
                                return true;
                            } catch (e) {
                                return false;
                            }
                        },
                        importance: 'medium',
                        description: '箭头函数语法'
                    },
                    {
                        name: 'Template Literals',
                        test: () => {
                            try {
                                eval('`template`');
                                return true;
                            } catch (e) {
                                return false;
                            }
                        },
                        importance: 'medium',
                        description: '模板字符串'
                    },
                    {
                        name: 'Destructuring',
                        test: () => {
                            try {
                                eval('const {a} = {a: 1}');
                                return true;
                            } catch (e) {
                                return false;
                            }
                        },
                        importance: 'medium',
                        description: '解构赋值'
                    },
                    {
                        name: 'Set/Map',
                        test: () => typeof Set !== 'undefined' && typeof Map !== 'undefined',
                        importance: 'medium',
                        description: '新数据结构'
                    }
                ];

                this.runTestCategory('api-tests', apiTests, 'webapi');
            }

            testAudioFeatures() {
                const audioTests = [
                    {
                        name: 'Audio Element',
                        test: () => typeof Audio !== 'undefined',
                        importance: 'high',
                        description: 'HTML5音频元素'
                    },
                    {
                        name: 'Web Audio API',
                        test: () => typeof AudioContext !== 'undefined' || typeof webkitAudioContext !== 'undefined',
                        importance: 'high',
                        description: '高级音频处理'
                    },
                    {
                        name: 'MP3 Support',
                        test: () => {
                            const audio = document.createElement('audio');
                            return !!(audio.canPlayType && audio.canPlayType('audio/mpeg'));
                        },
                        importance: 'high',
                        description: 'MP3格式支持'
                    },
                    {
                        name: 'WAV Support',
                        test: () => {
                            const audio = document.createElement('audio');
                            return !!(audio.canPlayType && audio.canPlayType('audio/wav'));
                        },
                        importance: 'medium',
                        description: 'WAV格式支持'
                    },
                    {
                        name: 'OGG Support',
                        test: () => {
                            const audio = document.createElement('audio');
                            return !!(audio.canPlayType && audio.canPlayType('audio/ogg'));
                        },
                        importance: 'medium',
                        description: 'OGG格式支持'
                    },
                    {
                        name: 'Audio Autoplay',
                        test: () => {
                            const audio = document.createElement('audio');
                            return 'autoplay' in audio;
                        },
                        importance: 'low',
                        description: '音频自动播放（注意浏览器策略）'
                    }
                ];

                this.runTestCategory('audio-tests', audioTests, 'audio');
            }

            testStorageFeatures() {
                const storageTests = [
                    {
                        name: 'localStorage',
                        test: () => {
                            try {
                                return typeof localStorage !== 'undefined' && localStorage !== null;
                            } catch (e) {
                                return false;
                            }
                        },
                        importance: 'high',
                        description: '本地存储支持'
                    },
                    {
                        name: 'sessionStorage',
                        test: () => {
                            try {
                                return typeof sessionStorage !== 'undefined' && sessionStorage !== null;
                            } catch (e) {
                                return false;
                            }
                        },
                        importance: 'medium',
                        description: '会话存储支持'
                    },
                    {
                        name: 'IndexedDB',
                        test: () => typeof indexedDB !== 'undefined',
                        importance: 'medium',
                        description: '大容量数据库存储'
                    },
                    {
                        name: 'File API',
                        test: () => typeof File !== 'undefined' && typeof FileReader !== 'undefined',
                        importance: 'high',
                        description: '文件处理API'
                    },
                    {
                        name: 'Blob API',
                        test: () => typeof Blob !== 'undefined',
                        importance: 'high',
                        description: '二进制数据处理'
                    },
                    {
                        name: 'URL.createObjectURL',
                        test: () => typeof URL !== 'undefined' && typeof URL.createObjectURL === 'function',
                        importance: 'high',
                        description: '对象URL创建'
                    }
                ];

                this.runTestCategory('storage-tests', storageTests, 'storage');
            }

            testCSSFeatures() {
                const cssTests = [
                    {
                        name: 'CSS Grid',
                        test: () => CSS.supports('display', 'grid'),
                        importance: 'high',
                        description: '网格布局支持'
                    },
                    {
                        name: 'CSS Flexbox',
                        test: () => CSS.supports('display', 'flex'),
                        importance: 'high',
                        description: '弹性布局支持'
                    },
                    {
                        name: 'CSS Variables',
                        test: () => CSS.supports('color', 'var(--test)'),
                        importance: 'high',
                        description: 'CSS自定义属性'
                    },
                    {
                        name: 'CSS Transforms',
                        test: () => CSS.supports('transform', 'translateX(1px)'),
                        importance: 'medium',
                        description: 'CSS变换'
                    },
                    {
                        name: 'CSS Transitions',
                        test: () => CSS.supports('transition', 'all 1s'),
                        importance: 'medium',
                        description: 'CSS过渡动画'
                    },
                    {
                        name: 'CSS Animations',
                        test: () => CSS.supports('animation', 'test 1s'),
                        importance: 'medium',
                        description: 'CSS关键帧动画'
                    },
                    {
                        name: 'backdrop-filter',
                        test: () => CSS.supports('backdrop-filter', 'blur(1px)'),
                        importance: 'low',
                        description: '背景滤镜效果'
                    }
                ];

                this.runTestCategory('css-tests', cssTests, 'css');
            }

            testMobileFeatures() {
                const mobileTests = [
                    {
                        name: 'Touch Events',
                        test: () => 'ontouchstart' in window,
                        importance: 'high',
                        description: '触摸事件支持'
                    },
                    {
                        name: 'Orientation Events',
                        test: () => 'onorientationchange' in window,
                        importance: 'medium',
                        description: '设备方向事件'
                    },
                    {
                        name: 'Device Motion',
                        test: () => 'DeviceMotionEvent' in window,
                        importance: 'low',
                        description: '设备运动传感器'
                    },
                    {
                        name: 'Vibration API',
                        test: () => 'vibrate' in navigator,
                        importance: 'low',
                        description: '震动API'
                    },
                    {
                        name: 'Network Information',
                        test: () => 'connection' in navigator,
                        importance: 'low',
                        description: '网络信息API'
                    },
                    {
                        name: 'Viewport Meta',
                        test: () => {
                            const viewport = document.querySelector('meta[name="viewport"]');
                            return viewport !== null;
                        },
                        importance: 'high',
                        description: '视口元标签'
                    }
                ];

                this.runTestCategory('mobile-tests', mobileTests, 'mobile');
            }

            runTestCategory(containerId, tests, category) {
                const container = document.getElementById(containerId);
                container.innerHTML = '';

                tests.forEach(testItem => {
                    const result = this.runSingleTest(testItem);
                    this.testResults[category] = this.testResults[category] || [];
                    this.testResults[category].push(result);

                    const testElement = this.createTestElement(result);
                    container.appendChild(testElement);
                });
            }

            runSingleTest(testItem) {
                this.totalTests++;
                
                try {
                    const passed = testItem.test();
                    if (passed) this.passedTests++;
                    
                    return {
                        name: testItem.name,
                        passed: passed,
                        importance: testItem.importance,
                        description: testItem.description,
                        error: null
                    };
                } catch (error) {
                    return {
                        name: testItem.name,
                        passed: false,
                        importance: testItem.importance,
                        description: testItem.description,
                        error: error.message
                    };
                }
            }

            createTestElement(result) {
                const div = document.createElement('div');
                div.className = 'test-item';

                const statusClass = result.passed ? 'supported' : 'unsupported';
                const statusIcon = result.passed ? '✅' : '❌';
                const statusText = result.passed ? '支持' : '不支持';

                div.innerHTML = `
                    <div class="test-name">${result.name}</div>
                    <div class="test-result">
                        <span class="status-icon ${statusClass}">${statusIcon}</span>
                        <span class="status-text ${statusClass}">${statusText}</span>
                        <span class="importance-badge ${result.importance}">[${result.importance}]</span>
                    </div>
                    <div class="feature-details">
                        ${result.description}
                        ${result.error ? `<br><strong>错误:</strong> ${result.error}` : ''}
                    </div>
                `;

                return div;
            }

            displayBrowserInfo() {
                const container = document.getElementById('browser-details');
                container.innerHTML = `
                    <p><strong>浏览器:</strong> ${this.browserInfo.name} ${this.browserInfo.version}</p>
                    <p><strong>引擎:</strong> ${this.browserInfo.engine}</p>
                    <p><strong>平台:</strong> ${this.browserInfo.platform}</p>
                    <p><strong>语言:</strong> ${this.browserInfo.language}</p>
                    <p><strong>Cookie启用:</strong> ${this.browserInfo.cookieEnabled ? '是' : '否'}</p>
                    <p><strong>在线状态:</strong> ${this.browserInfo.onLine ? '在线' : '离线'}</p>
                `;
            }

            calculateCompatibilityScore() {
                let totalWeight = 0;
                let passedWeight = 0;

                Object.values(this.testResults).flat().forEach(result => {
                    let weight = 1;
                    switch (result.importance) {
                        case 'high': weight = 3; break;
                        case 'medium': weight = 2; break;
                        case 'low': weight = 1; break;
                    }
                    
                    totalWeight += weight;
                    if (result.passed) {
                        passedWeight += weight;
                    }
                });

                const score = Math.round((passedWeight / totalWeight) * 100);
                
                document.getElementById('compatibility-summary').style.display = 'block';
                document.getElementById('compatibility-score').textContent = score + '%';
                
                let description = '';
                if (score >= 90) {
                    description = '🎉 优秀！浏览器对白噪音应用有极佳的兼容性支持';
                } else if (score >= 80) {
                    description = '👍 良好！浏览器对大部分功能有良好支持';
                } else if (score >= 70) {
                    description = '⚠️ 一般！部分功能可能存在兼容性问题';
                } else {
                    description = '❌ 较差！建议升级浏览器以获得更好的体验';
                }
                
                document.getElementById('compatibility-description').textContent = description;
            }

            generateRecommendations() {
                const recommendations = [];
                
                // 分析测试结果并生成建议
                Object.values(this.testResults).flat().forEach(result => {
                    if (!result.passed && result.importance === 'high') {
                        switch (result.name) {
                            case 'Fetch API':
                                recommendations.push('建议升级浏览器以支持Fetch API，或考虑使用XMLHttpRequest作为备选');
                                break;
                            case 'Audio Element':
                                recommendations.push('当前浏览器不支持HTML5音频，应用的核心功能将无法使用');
                                break;
                            case 'localStorage':
                                recommendations.push('缺少本地存储支持，用户设置将无法保存');
                                break;
                            case 'File API':
                                recommendations.push('不支持文件API，自定义音频上传功能将不可用');
                                break;
                            case 'CSS Grid':
                                recommendations.push('不支持CSS Grid，布局可能存在问题，建议使用Flexbox作为备选');
                                break;
                        }
                    }
                });

                // 添加浏览器特定建议
                if (this.browserInfo.name === '未知') {
                    recommendations.push('无法识别当前浏览器，建议使用主流现代浏览器以获得最佳体验');
                }

                if (parseInt(this.browserInfo.version) < 80 && this.browserInfo.name === 'Chrome') {
                    recommendations.push('Chrome版本较旧，建议升级到最新版本');
                }

                if (recommendations.length === 0) {
                    recommendations.push('🎉 当前浏览器完美支持白噪音应用的所有功能！');
                }

                this.displayRecommendations(recommendations);
            }

            displayRecommendations(recommendations) {
                const container = document.getElementById('recommendations');
                const listContainer = document.getElementById('recommendation-list');
                
                listContainer.innerHTML = '';
                recommendations.forEach(rec => {
                    const div = document.createElement('div');
                    div.className = 'recommendation-item';
                    div.textContent = rec;
                    listContainer.appendChild(div);
                });
                
                container.style.display = 'block';
            }
        }

        let compatibilityTester;

        function runCompatibilityTests() {
            compatibilityTester = new BrowserCompatibilityTester();
            compatibilityTester.runAllTests();
        }

        // 页面加载时自动显示浏览器信息
        document.addEventListener('DOMContentLoaded', function() {
            const tester = new BrowserCompatibilityTester();
            tester.displayBrowserInfo();
        });
    </script>
</body>
</html>