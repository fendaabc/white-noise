---
trigger: model_decision
description: 通用全局规则
---

# 全局开发规则

## 🚨 CRITICAL: Git提交规则 (最高优先级)

### 0. 强制Git提交要求
**这是最重要的规则，必须严格遵守，优先级高于所有其他规则**

- **每完成一个task中的任何一点（包括主要任务点和子任务点）后，必须立即进行git commit**
- **commit信息必须清晰描述完成的具体内容，格式：`feat/fix/refactor: [task编号] 具体完成内容`**
- **例如：`feat: [1.1] 实现用户认证基础接口和数据模型`**
- **可以不push到远程，但本地commit是强制要求**
- **这样做的目的是确保代码变更可追踪，出现问题时能够快速回退到任何一个完成的任务点**
- **如果一个任务点包含多个文件修改，可以分多次commit，但必须在该任务点完全完成后至少有一次commit**
- **commit前必须检查代码是否能正常运行，避免提交破坏性代码**



### 1.各类错误处理方案

针对ai变成过程中用户反馈的错误，需要进行记录，当用户反馈处理成功之后记录错误的原因和处理的方式，下次再遇到错误后优先检索文档，减少错误重复出现，文档是'/Users/tantan/code/AI代码开发常见问题合计.md'


## AI 编码助手协作优化

### 1. 上下文管理最佳实践
- 使用 `#File` 或 `#Folder` 引用特定文件或目录
- 使用 `#Codebase` 让 Kiro 扫描整个代码库
- 使用 `#Problems` 查看当前文件的问题
- 使用 `#Terminal` 和 `#Git Diff` 获取运行状态和变更信息
- 拖拽图片文件到聊天中进行图像分析

### 2. Kiro 工作流优化
- **并行操作：** 对于独立的文件修改，让 Kiro 并行执行多个操作
- **最小化代码：** 要求 Kiro 生成最小必要的代码，避免冗余实现
- **增量开发：** 使用 Spec 功能进行复杂项目的增量开发
- **Autopilot 模式：** 对于明确的重构任务，可以启用 Autopilot 让 Kiro 自主修改文件
- **Supervised 模式：** 对于重要变更，使用 Supervised 模式以便审查后应用

## 开发核心原则

### 3. 需求与实现策略
- 每次提问前，简明描述需求、目标和使用场景
- 将复杂问题拆解为小步骤，逐步实现与验证
- 提供具体的输入数据和期望输出比单纯文字描述更精确
- 优先研究 GitHub 上类似项目的成功实现，使用经过验证的开源库

### 4. 代码质量要求
- 使用有意义的变量和函数命名，遵循主流代码风格
- 关键函数、类需添加清晰注释，说明用途、参数、返回值
- 结构清晰，避免过度嵌套，拆分为单一职责的函数和类
- 处理常见异常和边界情况，避免程序崩溃
- 敏感信息使用环境变量，不在代码中硬编码

### 5. 安全与性能考虑
- 输入验证和输出编码必须到位
- 对数据库查询进行优化，避免 N+1 问题
- 合理使用缓存策略，但要注意缓存一致性
- 实现适当的访问控制和权限验证

## 版本控制与协作

### 6. Git 工作流
- 保持提交原子性，一个提交只做一件事
- 为新功能或修复创建独立分支，完成后合并到主分支
- 使用清晰的提交信息描述变更内容
- 定期清理无用的分支和标签

### 7. 影响范围评估
- 任何新增、修改、删除操作前，必须全面分析对现有功能的潜在影响
- 修改共享组件或工具函数时，需要检查所有调用点
- 优先采用增量式开发，避免大规模重构
- 新功能应该向后兼容，通过特性开关控制启用

## 架构与设计

### 8. 架构设计原则
- 遵循单一职责原则，保持模块职责清晰
- 使用依赖注入，降低模块间耦合
- 实现接口隔离，避免胖接口问题
- 采用分层架构，明确各层职责边界

### 9. 测试与文档
- 核心业务逻辑必须有单元测试覆盖
- 新增功能必须包含相应的测试用例
- 重要的设计决策必须有文档记录
- API 变更需要更新相应文档

## 错误处理与监控

### 10. 异常处理
- 建立统一的错误处理机制
- 区分可恢复和不可恢复的错误
- 提供有意义的错误信息给用户
- 记录详细的错误日志用于调试

### 11. 状态管理
- 避免全局状态滥用，优先使用局部状态
- 状态变更必须可预测和可追踪
- 复杂状态使用状态机模式管理

## 用户体验与国际化

### 12. 用户体验原则
- 优先考虑用户的核心使用场景
- 保持界面交互的一致性
- 提供清晰的加载状态和错误提示
- 确保在不同设备和屏幕尺寸下正常工作

### 13. 多语言支持
- 所有用户可见文本都要支持国际化
- 避免硬编码文本内容
- 时间和日期格式要符合当地习惯
- **沟通语言：** 在和用户沟通以及生成相应文档时尽可能使用中文，但该用其他语言的地方正常使用

## 资源优化与成本控制

### 14. 资源使用
- 避免内存泄漏和资源未释放
- 合理使用缓存，避免过度缓存
- 定期清理无用的依赖和代码
- 选择技术方案时要考虑维护成本

### 15. 技术债务管理
- 定期评估和清理技术债务
- 在新功能开发中适度重构旧代码
- 平衡新功能开发和代码质量提升
- 避免过度工程化和不必要的复杂性

## 项目配置与规则继承

### 16. 配置管理
- 新项目会自动继承 `~/.kiro/steering/` 中的全局规则
- 可在项目根目录创建 `.kiro/steering/` 覆盖或补充全局规则
- 使用 `#[[file:相对路径]]` 在 steering 文件中引用其他文档
- 环境特定的配置不能混用，使用环境变量管理敏感配置

---

**说明：** 本规范专为 AI 编码助手优化，充分利用其上下文管理、自动化和并行处理能力。适用于个人和团队项目，可根据项目需求在 `.kiro/steering/` 中添加项目特定规则。



# 跨项目「文档结构与 AI 读取」统一规则 v1.0（临时）

适用范围：任意项目。目标是让 AI 与人类在所有项目中以同一套路径命名、同一份“唯一真源”协作，便于自动读取、校验与自愈（自动补齐缺失文档模块）。

## 1. 顶层目录约定
- docs/：项目文档根目录（对外可读）
- docs/archive/：归档区（历史原型、路线图、过期文档）
- .kiro/specs/：规范三件套根目录（AI/Kiro 专用读取区，禁止移动/重命名）

建议目录骨架：
```
docs/
  00.INDEX.md
  01.prototype-<topic-or-version>.md
  prototype-current.md (或项目已有稳定别名，见下)
  02.issues.md
  03.backlog.md
  04.CHANGELOG.md
  archive/
    ROADMAP-*.md
```

## 2. 原型 = 唯一真源
- 排序文件（当前版本）：docs/01.prototype-<topic-or-version>.md
- 稳定别名（统一引用入口）：推荐 docs/prototype-current.md
  - 若项目已使用固定别名（如 docs/prototype-v3-interface.md）且存量引用较多，可继续沿用；新项目统一用 prototype-current.md
- 原则：任意内容冲突时，以“稳定别名”指向的原型为准，如果项目不存在原型文件，则创建空文件作为占位符
- 归档规则：版本切换时，去掉旧原型文件名中的 01. 前缀并移入 docs/archive/，仅更新“稳定别名”的指向

最小别名文件示例（prototype-current.md）：
```md
# 原型（稳定别名）
- 当前版本原型文件：[01.prototype-<topic-or-version>.md](./01.prototype-<topic-or-version>.md)
- 若与任何文档内容冲突，一律以本别名指向的原型为准
```

## 3. 规范三件套（Kiro 专用）
- 路径：/.kiro/specs/<topic-slug>/
- 文件：
  - requirements.md（需求规范：用户故事、验收标准）
  - design.md（技术设计：架构/接口/约束/测试策略）
  - tasks.md（实现任务与验收：映射需求编号，带提交提醒）
- 禁止：在三件套内写“未确认想法/规划”；此类内容仅放 docs/02.issues.md 与 docs/03.backlog.md
- 命名：<topic-slug> 用 kebab-case（如 enhanced-rename-interface）
- 文件头必含「来源与对齐声明」（模板）：
```md
### 来源与对齐声明
- 主来源：`docs/prototype-current.md`（或项目稳定别名）
- 辅来源：`docs/04.CHANGELOG.md`、`docs/archive/ROADMAP-*.md`
- 冲突处理：若与辅来源不一致，一律以原型文档为准
- 追踪约定：本文件编号在其他两份文档中一一映射
```

## 4. 问题/规划/变更/路线
- docs/02.issues.md：问题清单（Bug/体验/风险/待澄清），含模板
- docs/03.backlog.md：未来规划（尚未确认/待评估），含模板
- docs/04.CHANGELOG.md：对外可见变更记录（发布说明/重要修复/特性）
- docs/archive/ROADMAP-*.md：路线图（默认归档）

## 5. 链接与命名规范
- 统一指向稳定别名：所有引用原型时，统一指向 docs/prototype-current.md（或项目既有稳定别名）
- 相对路径：文档间引用使用相对路径，避免断链
- 移动/重命名：同步更新 README.md、docs/00.INDEX.md 与所有交叉引用

## 6. 版本轮转流程（AI 可自动化）
1) 创建新版本：复制上一版原型为 docs/01.prototype-*.md  
2) 更新稳定别名：令其指向新的 01. 文件  
3) 旧版归档：去掉旧文件名中的 01. 并移入 docs/archive/  
4) 校验链接：扫描并确保所有引用仍指向“稳定别名”而非具体版本文件

## 7. AI 助手自愈准则
- 若 README.md 无“文档结构与用途说明”，AI 应自动插入一节，内容等同本规则摘要，含路径与流程
- 若缺少关键文件，AI 应按最小模板自动创建（见上模板）
- 若三件套文件头缺“来源与对齐声明”，AI 应自动补齐
- 若存在对 01.* 的直接引用，AI 应批量替换为“稳定别名”
- 任何自动修改后，按用户“Git提交规则”原子提交

## 8. 团队导航索引（docs/00.INDEX.md）
- 内容应列出：
  - 原型（稳定别名）、CHANGELOG、ROADMAP（归档）、Issues、Backlog
  - `/.kiro/specs/<topic-slug>/` 下的三件套路径
  - 重要约定（禁止移动 `.kiro/specs/`、同步更新链接等）

---

# 按规则检查当前仓库的结论与建议

基于当前仓库路径（示例，仅报告与修正点）：

- 已符合
  - docs/ 结构齐全：00.INDEX.md、01.prototype-v3-interface.md、02.issues.md、03.backlog.md、04.CHANGELOG.md、archive/ROADMAP-v3.0.md
  - 稳定别名：docs/prototype-v3-interface.md 已存在并指向 01.prototype-v3-interface.md
  - /.kiro/specs/enhanced-rename-interface/ 三件套齐全，且均包含“来源与对齐声明”
  - README.md 已包含“文档结构与用途说明”，与仓库现状基本一致

- 需调整（优先级高 → 低）
  - 统一原型引用到稳定别名：
    - /.kiro/specs/enhanced-rename-interface/design.md 头部引用为 docs/01.prototype-v3-interface.md，建议改为 docs/prototype-v3-interface.md（与 requirements.md、tasks.md 保持一致，避免换版时批量改动）
  - 可选增强：增加通用稳定别名
    - 新增一个轻量别名 docs/prototype-current.md，内容仅指向现有 docs/prototype-v3-interface.md；这样对跨项目自动化脚本更友好，且不破坏现有引用
  - 索引一致性检查：
    - 变更上述引用后，同步快速 grep 校验 01.prototype-*.md 的直接引用是否还存在，若有则替换为稳定别名

- 建议的原子提交示例（供参考）
  - fix: [docs.rules] 统一 design.md 原型引用至稳定别名
  - feat: [docs.rules] 新增通用别名 docs/prototype-current.md 指向现有稳定别名
  - chore: [docs.rules] 清理直接引用 01.prototype-*.md 的链接并对齐索引

